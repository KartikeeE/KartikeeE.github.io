{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "description": "GDP per capita vs Life expectancy (2022)",
  "width": 650,
  "height": 420,
  "data": {
    "url": "https://api.worldbank.org/v2/country/IND;CHN;BRA;IDN;ZAF;BGD;PAK;LKA;GBR/indicator/NY.GDP.PCAP.CD?format=json&per_page=20000",
    "format": { "type": "json", "property": "1" }
  },
  "transform": [
    { "filter": "datum.date === '2022' && datum.value != null" },
    {
      "lookup": "country.id",
      "from": {
        "data": {
          "url": "https://api.worldbank.org/v2/country/IND;CHN;BRA;IDN;ZAF;BGD;PAK;LKA;GBR/indicator/SP.DYN.LE00.IN?format=json&per_page=20000",
          "format": { "type": "json", "property": "1" }
        },
        "key": "country.id",
        "fields": ["value", "date"]
      },
      "as": ["lifeExp", "lifeExpYear"]
    },
    { "filter": "datum.lifeExpYear === '2022' && datum.lifeExp != null" },
    { "calculate": "datum.country.value", "as": "countryName" },
    { "calculate": "datum.value", "as": "gdpPc" }
  ],
  "mark": { "type": "circle", "size": 180, "opacity": 0.85 },
  "encoding": {
    "x": {
      "field": "gdpPc",
      "type": "quantitative",
      "title": "GDP per capita (current US$)",
      "scale": { "type": "log" }
    },
    "y": {
      "field": "lifeExp",
      "type": "quantitative",
      "title": "Life expectancy (years)"
    },
    "tooltip": [
      { "field": "countryName", "type": "nominal", "title": "Country" },
      { "field": "gdpPc", "type": "quantitative", "title": "GDP per capita (US$)", "format": ",.0f" },
      { "field": "lifeExp", "type": "quantitative", "title": "Life expectancy", "format": ".1f" }
    ]
  }
}
